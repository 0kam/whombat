"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6072],{40072:function(e,t,n){n.d(t,{Z:function(){return i}});var s=n(14357),l=n(5374),a=n.n(l);function i(e){let{children:t,className:n,...l}=e;return(0,s.jsx)("div",{className:a()("border shadow flex flex-col gap-3 p-4 rounded-md border-stone-300 dark:border-stone-700 text-stone-700 dark:text-stone-300",n),...l,children:t})}},24070:function(e,t,n){n.d(t,{H1:function(){return i},H3:function(){return r},H4:function(){return o}});var s=n(14357),l=n(5374),a=n.n(l);function i(e){let{children:t,className:n,...l}=e;return(0,s.jsx)("h1",{className:a()("text-2xl font-bold text-stone-900 dark:text-stone-200",n),...l,children:t})}function r(e){let{children:t,className:n,...l}=e;return(0,s.jsx)("h3",{className:a()("text-lg font-semibold leading-7 items-center text-stone-900 dark:text-stone-200",n),...l,children:t})}function o(e){let{children:t,className:n,...l}=e;return(0,s.jsx)("h4",{className:a()("text-md font-semibold leading-6 text-stone-900 dark:text-stone-200",n),...l,children:t})}},96489:function(e,t,n){n.d(t,{Z:function(){return a}});var s=n(14357),l=n(11391);function a(e){let{checked:t,onChange:n,label:a="Toggle"}=e;return(0,s.jsxs)(l.r,{checked:t,onChange:n,className:"".concat(t?"bg-emerald-600 dark:bg-emerald-500":"bg-emerald-900 dark:bg-emerald-800","\n          relative inline-flex h-5 w-12 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-4 focus:ring-emerald-500/50 focus-visible:ring-4 focus-visible:ring-emeral-500/50"),children:[(0,s.jsx)("span",{className:"sr-only",children:a}),(0,s.jsx)("span",{"aria-hidden":"true",className:"".concat(t?"translate-x-7":"translate-x-0","\n            pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out")})]})}},76283:function(e,t,n){n.d(t,{Z:function(){return Z}});var s=n(14357),l=n(6439),a=n(89462),i=n(56492),r=n(51768),o=n(27862),c=n(28217),d=n(35573),u=n(56793),m=n(68840),p=n(38425),h=n(40072),x=n(96489),f=n(60169),g=n(54251);function b(e,t){for(var n,s,l=e.slice(0),a=e.length;a--;)n=l[s=Math.floor((a+1)*Math.random())],l[s]=l[a],l[a]=n;return l.slice(0,t)}function j(e){var t,n,a;let{onSelection:o}=e,[f,j]=(0,l.useState)({subsample:!1,maxRecordings:5e3}),v=(0,i.Z)({pageSize:1e3}),N=(0,l.useMemo)(()=>{var e;return{dataset:null!==(n=null==f?void 0:null===(e=f.dataset)||void 0===e?void 0:e.id)&&void 0!==n?n:-1}},[null==f?void 0:null===(t=f.dataset)||void 0===t?void 0:t.id]),Z=(0,r.Z)({pageSize:1e4,filter:N});return(0,l.useEffect)(()=>{(null==f?void 0:f.dataset)!=null&&(f.subsample?o([...b(Z.items,f.maxRecordings)]):o([...Z.items]))},[f,Z.items,o]),(0,s.jsxs)(h.Z,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg",children:"Select Recordings"}),(0,s.jsx)("p",{className:"text-stone-500",children:"Choose the recordings from which to extract clips to add to the annotation project."})]}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(d.BZ,{name:"dataset",label:"Choose a dataset",help:"Select a dataset from which to source recordings.",children:(0,s.jsx)(c.Z,{value:null==f?void 0:f.dataset,options:null!==(a=v.items)&&void 0!==a?a:[],onSelect:e=>{j(t=>({...t,dataset:e})),Z.filter.set("dataset",e.id,!0)},displayValue:e=>e.name,getOptionKey:e=>e.id,fields:["name"],renderOption:e=>e.name,limit:6,static:!1})})}),(0,s.jsx)("div",{children:(0,s.jsx)(d.BZ,{name:"recording-filter",label:"Filter recordings",help:"Optionally, select a subset of recordings to extract clips from by applying some filters.",children:(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,s.jsx)("div",{className:"grow",children:(0,s.jsx)(p.C,{showIfEmpty:!0,filter:Z.filter})}),(0,s.jsx)(m.Z,{filter:Z.filter,filterDefs:g.Z,button:(0,s.jsxs)("span",{className:"text-emerald-900",children:["Add filters"," ",(0,s.jsx)(u.k1,{className:"inline-block h-4 w-4 stroke-2"})]})})]})})}),(0,s.jsx)("div",{children:(0,s.jsx)(d.BZ,{name:"subsample",label:"Subsample recordings",help:"Set a maximum number of recordings to extract clips from. A random subset of recordings will be selected. If not set, all recordings will be used.",children:(0,s.jsxs)("div",{className:"inline-flex items-center w-full gap-3",children:[(0,s.jsx)(x.Z,{checked:f.subsample,onChange:e=>j(t=>({...t,subsample:e}))}),(0,s.jsx)(d.II,{className:"grow",type:"number",placeholder:"Maximum number of recordings",value:f.subsample?f.maxRecordings:void 0,onChange:e=>j(t=>({...t,maxRecordings:e.target.valueAsNumber})),required:f.subsample,disabled:!f.subsample})]})})})]})}function v(e){let{onExtraction:t,selectedRecordings:n}=e,[a,i]=(0,l.useState)({clipLength:10,subsample:!1,maxClipsPerRecording:10,clip:!0,overlap:0});return(0,l.useEffect)(()=>{t(function(e){let{recordings:t,config:n}=e,s=[],{clipLength:l,clip:a,subsample:i,overlap:r,maxClipsPerRecording:o}=n;for(let e of t){if(!a){s.push({recording_id:e.id,start_time:0,end_time:e.duration});continue}let t=[],n=Math.ceil(e.duration/(l-r));for(let s=0;s<n;s++){let n=s*(l-r),a=n+l;t.push({recording_id:e.id,start_time:n,end_time:a})}if(!i){s.push(...t);continue}let c=b(t,o);s.push(...c)}return s}({recordings:n,config:a}))},[t,n,a]),(0,s.jsxs)(h.Z,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg",children:"Clip Extraction"}),(0,s.jsx)("p",{className:"text-stone-500",children:"Choose how to extract clips from the selected recordings."})]}),(0,s.jsx)(d.BZ,{name:"clip",label:"Should Clip",help:"If checked, smaller clips will be extracted from the recordings. If unchecked, the whole recording will be added as a clip.",children:(0,s.jsx)(x.Z,{checked:a.clip,onChange:e=>i(t=>({...t,clip:e}))})}),a.clip&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.BZ,{name:"clipLength",label:"Clip Length",help:"The length of each clip in seconds.",children:(0,s.jsx)(d.II,{type:"number",value:a.clipLength,onChange:e=>i(t=>({...t,clipLength:e.target.valueAsNumber})),required:!0})}),(0,s.jsx)(d.BZ,{name:"overlap",label:"Overlap",help:"The amount of overlap between clips in seconds.",children:(0,s.jsx)(d.II,{type:"number",value:a.overlap,onChange:e=>i(t=>({...t,overlap:e.target.valueAsNumber})),required:!0})}),(0,s.jsx)(d.BZ,{name:"subsample",label:"Subsample clips",help:"Set a maximum number of clips to extract from each recording. A random subset of clips will be selected. If not set, all clips will be used.",children:(0,s.jsxs)("div",{className:"inline-flex items-center w-full gap-3",children:[(0,s.jsx)(x.Z,{checked:a.subsample,onChange:e=>i(t=>({...t,subsample:e}))}),(0,s.jsx)(d.II,{className:"grow",type:"number",placeholder:"-",value:a.subsample?a.maxClipsPerRecording:void 0,onChange:e=>i(t=>({...t,maxClipsPerRecording:e.target.valueAsNumber})),required:a.subsample,disabled:!a.subsample})]})})]})]})}function N(e){let{clips:t,recordings:n,onAdd:l}=e;return(0,s.jsxs)(h.Z,{children:[(0,s.jsx)("h2",{className:"text-lg",children:"Summary"}),(0,s.jsxs)("ul",{className:"list-disc list-inside",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"text-blue-500 font-bold",children:t.length})," clips"]}),(0,s.jsxs)("li",{children:["from"," ",(0,s.jsx)("span",{className:"text-blue-500 font-bold",children:n.length})," ","recordings"]})]}),(0,s.jsx)("p",{className:"text-stone-500",children:"When ready click on the button below to add clips to the annotation project."}),(0,s.jsx)(f.Z,{onClick:l,children:"Add Clips"})]})}function Z(e){let{project:t}=e,n=(0,o.Z)({annotation_project_id:t.id}),[i,r]=(0,l.useState)([]),[c,d]=(0,l.useState)([]);return(0,s.jsxs)("div",{className:"flex flex-row gap-8",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-6",children:[(0,s.jsx)(j,{onSelection:r}),(0,s.jsx)(v,{onExtraction:d,selectedRecordings:i})]}),(0,s.jsx)("div",{className:"basis-96",children:(0,s.jsx)("div",{className:"sticky top-8",children:(0,s.jsx)(N,{clips:c,recordings:i,onAdd:()=>{a.ZP.promise(n.addClips.mutateAsync(c,{onSuccess:()=>{d([]),r([])}}),{loading:"Adding clips to project...",success:"Clips added to project \uD83C\uDF89! Add more clips or go to the project page to start annotating. ",error:"Failed to add clips to project."})}})})})]})}},27862:function(e,t,n){n.d(t,{Z:function(){return r}});var s=n(30646),l=n(72007),a=n(62976),i=n(81361);function r(e){let{annotation_project_id:t,onUpdate:n,onDelete:r,onAddTag:o,onRemoveTag:c,onAddClips:d}=e,u=(0,s.NL)(),m=(0,l.a)(["annotation_project",t],()=>i.Z.annotation_projects.get(t)),p=(0,a.D)({mutationFn:async e=>await i.Z.annotation_projects.update(t,e),onSuccess:e=>{null==n||n(e),m.refetch()}}),h=(0,a.D)({mutationFn:async e=>await i.Z.annotation_projects.addTag(t,e),onSuccess:e=>{null==o||o(e),m.refetch()}}),x=(0,a.D)({mutationFn:async e=>await i.Z.annotation_projects.removeTag(t,e),onSuccess:e=>{null==c||c(e),m.refetch()}}),f=(0,a.D)({mutationFn:async()=>await i.Z.annotation_projects.delete(t),onSuccess:e=>null==r?void 0:r(e)}),g=(0,a.D)({mutationFn:async e=>{let n=await i.Z.clips.createMany(e);return await i.Z.tasks.createMany(n.map(e=>({project_id:t,clip_id:e.id})))},onSuccess:e=>{null==d||d(e),u.invalidateQueries(["tasks"])}});return{query:m,update:p,addTag:h,addClips:g,removeTag:x,delete:f}}},56492:function(e,t,n){n.d(t,{Z:function(){return r}});var s=n(81361),l=n(11441),a=n(54313);let i={};function r(){let{filter:e=i,pageSize:t=10}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,a.Z)({fixed:e}),{query:r,pagination:o,items:c,total:d}=(0,l.Z)({name:"datasets",func:s.Z.datasets.getMany,pageSize:t,filter:n.filter});return{query:r,filter:n,pagination:o,items:c,total:d}}}}]);